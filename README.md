[![crates.io version](https://img.shields.io/crates/v/marine-rs-sdk?color=green)](https://crates.io/crates/marine-rs-sdk)

## Marine Rust SDK

This SDK empowers developers to create suitable general-purpose Wasm services executable by the [Marine](https://github.com/fluencelabs/marine) runtime. Such services are constructed from one or more Wasm modules with the help of [interface-types](https://github.com/WebAssembly/interface-types) and a [shared-nothing linking](https://training.linuxfoundation.org/blog/how-and-why-to-link-webassembly-modules/) scheme. Each module results from Rust code compiled to `wasm32-wasi` compile target with some glue code auto-generated by this SDK. The primary purpose of the SDK influenced its design is to provide developers a way to write Wasm modules on "vanilla" Rust, wrapping necessary blocks with the supplied macros.


## Usage

The core component of the SDK is the #[marine] macro that should be used with export functions, extern blocks, and structures. Let's consider a simplest scenario with a module with one export function:
```rust
#[marine]
use marine_rs_sdk::marine;
use marine_rs_sdk::module_manifest;

#[marine]
pub fn greeting(name: String) -> String {
    format!("Hi, {}", name)
}
```
This code imports the Marine SDK and wraps the greeting function with the #[marine] macro. Every function wrapped in such way will be exported from a compiled Wasm module.

To build this module into Wasm, you'll be needed the marine CLI tool (`cargo install marine` to install):

```bash
marine build --release
```

Finally, you could obtain some build info from the resulted binary and play with it with the help of mrepl (`cargo install mrepl` to install):

```bash
> marine info ./target/wasm32-wasi/release/greeting.wasm
it version:  0.23.1
sdk version: 0.6.0
authors:     <user-name>
version:     0.1.0
description:
repository:
build time:  2022-05-15 14:52:37.865550 +00:00 UTC

> mrepl --quiet
1> load greeting ./target/wasm32-wasi/release/greeting.wasm
module successfully loaded into App service
elapsed time: 52.153308ms

2> interface
Application service interface:
greeting:
  fn greeting(name: String) -> String

3> call greeting greeting "user"
result: String("Hi, user")
 elapsed time: 132.021Âµs
```

The complete guide of developing this simple module could be found [here](https://fluence.dev/docs/marine-book/quick-start/develop-a-single-module-service).


## SDK components

The SDK exports the following major components:
- `#[marine]` procedure macro that could be applied to
    - [function](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/export-functions) making it export from a module
    - [extern block](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/import-functions) making it imported from a module in a Marine-suitable way
    - [structure](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/structures), making it usable as an argument of an export or an import function
- [call parameters interface](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/call-parameters) intended to provide a set of module start parameters
- [mounted binaries interface](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/mounted-binaries) that can be used to call a CLI tool
- [module_manifest](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/module-manifest) macro intended to embed some info into a compiled Wasm
- [logging stuff](https://fluence.dev/docs/marine-book/marine-rust-sdk/developing/logging) that allows adjusting a Marine logging mechanism


## Supported Rust types

At the time, the `#[marine]` macro allows using the following Rust types as an argument of export and import function or field of a structure:
- one of the following Rust basic types: `bool`, `u8`, `u16`, `u32`, `u64`, `i8`, `i16`, `i32`, `i64`, `f32`, `f64`
- strings `String`, `&str`
- a vector of elements of the above types
- a vector composed of vectors of the above type, where recursion is acceptable, e.g. the type `Vec<Vec<Vec<u8>>>` is permissible
- a reference to all of the above types
- a structure where all fields are of the basic Rust types
- a structure where all fields are of any above types or other structures build with such a way


## Documentation

- [Marine Book](https://fluence.dev/docs/marine-book/introduction)
- [Marine Examples](https://github.com/fluencelabs/examples/tree/main/marine-examples)
- [Quickstart](https://fluence.dev/docs/marine-book/quick-start/)


## Repository structure

- **[crates](./crates)**
    - [macro-testing-utils](./crates/macro-testing-utils) - internal testing utils
    - [main](./crates/main) - contains export_allocator, logger and results modules
    - [marine-macro](./crates/marine-macro) - proc-macro crate for the `#[marine]` macro
    - [marine-macro-impl](./crates/marine-macro-impl) - the actual realization of the `#[marine]` macro
    - [timestamp-macro](./crates/timestamp-macro) - a macro to support timestamp embedding into a compiled Wasm binary
- **[src](./src)** - contains call_parameters and mounted_binary modules along with reexporting all necessary for a user stuff


## Support

Please, [file an issue](https://github.com/fluencelabs/marine-rs-sdk/issues) if you find a bug. You can also contact us at [Discord](https://discord.com/invite/5qSnPZKh7u) or [Telegram](https://t.me/fluence_project). We will do our best to resolve the issue ASAP.


## Contributing

Any interested person is welcome to contribute to the project. Please, make sure you read and follow some basic [rules](./CONTRIBUTING.md).


## License

All software code is copyright (c) Fluence Labs, Inc. under the [Apache-2.0](./LICENSE) license.

